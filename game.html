<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Virtual Ranch</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Firebase SDK (as ES module) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCkFOc0BwRqmR2LkjHj0vwXSAS1h4BlBCE",
      authDomain: "horse-game-by-sxxrrx.firebaseapp.com",
      projectId: "horse-game-by-sxxrrx",
      storageBucket: "horse-game-by-sxxrrx.appspot.com",
      messagingSenderId: "87883054918",
      appId: "1:87883054918:web:4771a90eb5c6a3e7c0ef47",
      measurementId: "G-ZW6W5HVXBJ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Optional: store globally
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDatabase = database;
  </script>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Left Sidebar -->
    <div class="sidebar left-sidebar">
      <h3>Virtual Ranch</h3>
      <ul>
        <li onclick="showTab('myranch')">My Ranch</li>
        <li onclick="showTab('stables')">Stables</li>
        <li onclick="showTab('sales')">Sales</li>
        <li onclick="showTab('Shows')">Shows</li>
        <li onclick="showTab('training')">Training</li>
        <li onclick="showTab('jobs')">Jobs</li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-panel">
      <h2 id="welcomeUser"></h2>
      <div id="coinCounter">Coins: 0</div>

      <div id="newsSection">
        <h3>Latest News</h3>
        <div id="newsList"></div>
      </div>

      <!-- My Ranch -->
      <div id="myranch" class="content">
        <h2>Your Ranch</h2>
        <div class="player-profile">
          <p><strong>Username:</strong> <span id="profileUsername"></span></p>
          <p><strong>Level:</strong> <span id="profileLevel"></span></p>
          <p><strong>Current Job:</strong> <span id="profileJob"></span></p>
          <p><strong>Total Horses:</strong> <span id="profileHorseCount"></span></p>
          <p><strong>Join Date:</strong> <span id="profileJoinDate"></span></p>
          <p><strong>EXP:</strong> <span id="profileExp"></span></p>
          <div style="background: #ccc; border-radius: 5px; overflow: hidden; height: 20px;">
            <div id="profileExpBar" style="width: 0%; background: #4caf50; height: 100%;"></div>
          </div>
        </div>
      </div>

      <!-- Stables -->
      <div id="stables" class="content">
        <h2>Your Stable</h2>
        <div id="stableGrid" class="stable-grid"></div>
      </div>

      <!-- Horse Detail -->
      <div id="horseDetail" class="content" style="display: none;">
        <h2 id="horseNameDetail"></h2>
        <div id="horseDetailInfo"></div>
        <button onclick="changeHorseName()">Change Name</button>
        <button onclick="prepareBreeding()">Breed</button>
        <button onclick="enterShow()">Enter Shows</button>
        <button onclick="showTab('stables')">Back to Stable</button>
      </div>

      <!-- Sales -->
      <div id="sales" class="content">
        <h2>Horses for Sale</h2>
        <div id="salesList"></div>
      </div>

      <!-- Shows / Training -->
      <div id="shows" class="content">
        <h2>Horse Shows</h2>
        <p>Enter your horses into competitions to gain EXP and level up!</p>
        <div id="showEntries"></div>
      </div>
      <div id="training" class="content"><h2>Training</h2></div>

      <!-- Jobs -->
      <div id="jobs" class="content">
        <h2>Jobs</h2>
        <div id="jobInfo"></div>
        <div id="jobActions"></div>
      </div>

      <!-- Clubhouse -->
      <div id="clubhouse" class="content">
        <h2>Clubhouse</h2>
        <div id="riderInfo"></div>
      </div>

      <!-- Barn -->
      <div id="barn" class="content">
        <h2>Barn</h2>
        <div id="barn-tabs">
          <div id="inventory" class="barn-tab">
            <h3>Inventory</h3>
            <div id="inventoryContent">Inventory items will display here</div>
          </div>
          <div id="workshop" class="barn-tab" style="display:none">
            <h3>Workshop</h3>
            <button onclick="craftTack('Bridle')">Craft Bridle</button>
            <button onclick="craftTack('Saddle')">Craft Saddle</button>
            <button onclick="craftTack('Horse Boots')">Craft Horse Boots</button>
            <button onclick="craftTack('Horse Shoes')">Craft Horse Shoes</button>
          </div>
          <div id="tackroom" class="barn-tab" style="display:none">
            <h3>Tack Room</h3>
            <div id="tackContent">Crafted tack items will show here</div>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div id="settings" class="content">
        <h2>Settings</h2>
        <button onclick="logout()">Log Out</button>
      </div>
    </div>

    <!-- Right Sidebar -->
    <div class="sidebar right-sidebar">
      <ul>
        <li onclick="showTab('barn')">Barn</li>
        <li onclick="showSubTab('barn', 'inventory')">- Inventory</li>
        <li onclick="showSubTab('barn', 'workshop')">- Workshop</li>
        <li onclick="showSubTab('barn', 'tackroom')">- Tack Room</li>
        <li onclick="showTab('clubhouse')">Clubhouse</li>
        <li onclick="showTab('settings')">Settings</li>
      </ul>
    </div>
  </div>

  <!-- Script -->
  <script src="script.js"></script>
  <script>
    function showTab(id) {
      document.querySelectorAll('.content').forEach(c => c.style.display = 'none');
      const el = document.getElementById(id);
      if (el) el.style.display = 'block';
      document.getElementById("newsSection").style.display = (id === 'myranch') ? 'block' : 'none';
    }

    function showSubTab(main, subId) {
      document.querySelectorAll(`#${main} .barn-tab`).forEach(tab => tab.style.display = 'none');
      const sub = document.getElementById(subId);
      if (sub) sub.style.display = 'block';
      showTab(main);
    }

    function logout() {
      localStorage.removeItem("activeUser");
      localStorage.removeItem("salesHorses");
      window.location.href = "index.html";
    }

    function showHorseDetails(horseId) {
      const user = JSON.parse(localStorage.getItem("activeUser"));
      const horse = user.horses.find(h => h.id === horseId);
      if (!horse) return alert("Horse not found.");
      document.getElementById("horseNameDetail").textContent = horse.name;
      const expNeeded = horse.level === 1 ? 100 : horse.level === 2 ? 250 : 500;
      const expPercent = Math.min((horse.exp / expNeeded) * 100, 100);
      document.getElementById("horseDetailInfo").innerHTML = `
        <p><strong>Breed:</strong> ${horse.breed}</p>
        <p><strong>Coat Color:</strong> ${horse.coatColor}</p>
        <p><strong>Gender:</strong> ${horse.gender}</p>
        <p><strong>Age:</strong> ${horse.age?.years || 3} years</p>
        <p><strong>Level:</strong> ${horse.level || 1}</p>
        <p><strong>EXP:</strong> ${horse.exp || 0} / ${expNeeded}</p>
        <div style="background: #ccc; height: 20px; border-radius: 5px;">
          <div style="background: green; height: 100%; width: ${expPercent}%;"></div>
        </div>
      `;
      localStorage.setItem("selectedHorseId", horseId);
      showTab("horseDetail");
    }

    function changeHorseName() {
      const newName = prompt("Enter a new name for your horse:");
      if (!newName) return;
      const user = JSON.parse(localStorage.getItem("activeUser"));
      const horseId = localStorage.getItem("selectedHorseId");
      const horse = user.horses.find(h => h.id === horseId);
      if (!horse) return;
      horse.name = newName;
      localStorage.setItem("activeUser", JSON.stringify(user));
      showHorseDetails(horseId);
      renderStables(user);
    }

    function prepareBreeding() {
      const user = JSON.parse(localStorage.getItem("activeUser"));
      const horseId = localStorage.getItem("selectedHorseId");
      const horse = user.horses.find(h => h.id === horseId);
      if (!horse) return;
      const options = user.horses.filter(h =>
        h.id !== horse.id &&
        ((horse.gender === "Mare" && h.gender === "Stallion") ||
         (horse.gender === "Stallion" && h.gender === "Mare"))
      );
      if (options.length === 0) return alert("No eligible partners found.");
      const names = options.map(h => `${h.name} (${h.breed})`).join("\n");
      const chosen = prompt("Choose partner:\n" + names);
      const match = options.find(h => `${h.name} (${h.breed})` === chosen);
      if (match) alert(`${horse.name} and ${match.name} have been bred!`);
    }

    window.onload = () => {
      const user = JSON.parse(localStorage.getItem("activeUser"));
      if (!user) return window.location.href = "login.html";

      // If user has no horses, create a default one
      if (!user.horses || user.horses.length === 0) {
        user.horses = [
          {
            id: 'horse_' + Date.now(),
            name: "Arabian (Grey Stallion)",
            breed: "Arabian",
            coatColor: "Grey",
            gender: "Stallion",
            level: 1,
            exp: 0,
            age: {
              years: 3,
              months: 0
            },
            image: "horse-placeholder.png"
          }
        ];
        localStorage.setItem("activeUser", JSON.stringify(user));
      }

      document.getElementById("welcomeUser").textContent = `Welcome, ${user.username}!`;
      document.getElementById("coinCounter").textContent = `Coins: ${user.coins}`;

      const news = [
        "Welcome to HORSE GAME",
        "New event: coming soon...",
        "News Update: New Version of HORSE GAME v4.1.1"
      ];
      const newsListContainer = document.getElementById("newsList");
      news.forEach(item => {
        const div = document.createElement("div");
        div.textContent = item;
        newsListContainer.appendChild(div);
      });

      showProfile(user);
      renderStables(user);
      renderSalesHorses(user);
      setupJobs(user);
      showRider(user);
      showTack(user);
      showTab("stables");
    };
    <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>

<script>
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCkFOc0BwRqmR2LkjHj0vwXSAS1h4BlBCE",
    authDomain: "horse-game-by-sxxrrx.firebaseapp.com",
    projectId: "horse-game-by-sxxrrx",
    storageBucket: "horse-game-by-sxxrrx.firebasestorage.app",
    messagingSenderId: "87883054918",
    appId: "1:87883054918:web:4771a90eb5c6a3e7c0ef47",
    measurementId: "G-ZW6W5HVXBJ"
  };

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>

<script>
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCkFOc0BwRqmR2LkjHj0vwXSAS1h4BlBCE",
    authDomain: "horse-game-by-sxxrrx.firebaseapp.com",
    projectId: "horse-game-by-sxxrrx",
    storageBucket: "horse-game-by-sxxrrx.firebasestorage.app",
    messagingSenderId: "87883054918",
    appId: "1:87883054918:web:4771a90eb5c6a3e7c0ef47",
    measurementId: "G-ZW6W5HVXBJ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>

<script>
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCkFOc0BwRqmR2LkjHj0vwXSAS1h4BlBCE",
    authDomain: "horse-game-by-sxxrrx.firebaseapp.com",
    projectId: "horse-game-by-sxxrrx",
    storageBucket: "horse-game-by-sxxrrx.firebasestorage.app",
    messagingSenderId: "87883054918",
    appId: "1:87883054918:web:4771a90eb5c6a3e7c0ef47",
    measurementId: "G-ZW6W5HVXBJ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
<script type="module" src="firebase-init.js">

  </script>
</body>
</html>
